# NerdCam — Tasks 2026-02-20

## Priority 1: Code Review Before Continuing

The Sprint 2 refactor session was long and messy. While the app appears functional, the code quality is not trusted. A full code review is needed before adding any new features.

- [ ] Create `code-reviewer` agent
- [ ] Full code review of all 12 modules in `nerdcam/` package
  - Check for SOLID, DRY, KISS violations
  - Check for dead code, unused imports, inconsistent patterns
  - **Known issue:** `cli.py` still has 9 `global` statements with bridge functions — the plan called for full migration to `AppState` dataclass but this was only partially done. Evaluate whether to complete the migration or document the current approach as intentional.
  - Check that module boundaries are clean (no circular deps, proper separation of concerns)
  - Check `nerdcam_template.html` JavaScript quality (accumulated complexity, missing form field id/name attributes causing Chromium warnings)
- [ ] Fix issues found in code review
- [ ] PTZ Go bug (needs camera testing — blocked until code review done)

## Priority 2: Sprint 2 Completion

- [ ] Full regression test (after code review fixes)
- [ ] Merge dev → main

## Completed (previous sessions)

### Sprint 1 Closure
- [x] Archive Sprint 1 plan, todo, and summary
- [x] Update roadmap (Sprint 1 complete, Sprint 2/3 reshuffled)
- [x] Update AI_INSTRUCTIONS.md (language rule, current priority)
- [x] Doc-keeper audit — fix stale references (stream-debugger agent, concept.md, roadmap)

### Sprint 2: Modular Refactor (Phases A-E)
- [x] A1-A3: Package skeleton, crypto.py, camera_cgi.py
- [x] B1-B2: state.py (AppState), config.py
- [x] C1-C5: streaming.py, recording.py, patrol.py, ptz.py, camera_control.py
- [x] D1: server.py (route dispatcher + structured error responses)
- [x] E1-E2: cli.py cleanup, doc updates

### Additional work done during Sprint 2
- [x] Server-side rendered viewer (template in-memory, no file on disk)
- [x] Remove `/api/stream` endpoint (redundant with fMP4)
- [x] CLI menu restructure (toggle server, settings submenus)
- [x] Cross-browser stream disconnect/reconnect (MJPEG watchdog, MSE health check)
- [x] Fix `setVideoStreamParam` CGI (requires all params + streamType)
- [x] VBR/CBR toggle in video settings
- [x] ONVIF probe tool (`tools/onvif_probe.py`)
- [x] Auto time sync on startup (DST-aware)
- [x] Doc-keeper full audit and doc cleanup
