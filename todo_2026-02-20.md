# NerdCam — Tasks 2026-02-20

## Sprint 1 Closure
- [x] Archive Sprint 1 plan, todo, and summary
- [x] Update roadmap (Sprint 1 complete, Sprint 2/3 reshuffled)
- [x] Update AI_INSTRUCTIONS.md (language rule, current priority)
- [x] Doc-keeper audit — fix stale references (stream-debugger agent, concept.md, roadmap)

## Sprint 2: Modular Refactor

### Phase A: Foundation
- [x] A1: Create `nerdcam/` package skeleton + thin launcher
- [x] A2: Extract `crypto.py`
- [x] A3: Extract `camera_cgi.py`

### Phase B: State Centralization
- [x] B1: Create `state.py` with `AppState` dataclass
- [x] B2: Extract `config.py` with AppState parameter

### Phase C: Module Extraction
- [x] C1: Extract `streaming.py` (MjpegSource class)
- [x] C2: Extract `recording.py` (Recorder class + configurable output dir)
- [x] C3: Extract `patrol.py` (PatrolController class)
- [x] C4: Extract `ptz.py` (PTZ Go bug not yet fixed — needs camera testing)
- [x] C5: Extract `camera_control.py`

### Phase D: Server Decomposition
- [x] D1: Extract `server.py` (route dispatcher + structured error responses)

### Phase E: Cleanup + Finalization
- [x] E1: Clean up `cli.py` (remove unused imports, fix compression_config hack)
- [x] E2: Update docs (AI_INSTRUCTIONS.md, README.md, roadmap.md, concept.md, agents)
- [x] Remove `/api/stream` endpoint (redundant — fMP4 covers same use case, VLC plays it fine)
- [x] Update stream URL menus (option 2 + option 3) to reflect fMP4 instead of stream
- [x] Fix `setVideoStreamParam` CGI — required all params + streamType together, now works
- [x] ONVIF probe tool (`tools/onvif_probe.py`) — query camera hardware specs, confirmed max bitrate 4096 kbps
- [ ] Fix PTZ Go bug (needs camera testing)
- [ ] Full regression test
- [ ] Merge dev → main
